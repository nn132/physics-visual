<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°æµ‹è¯• - æ•°æ®æ ¼å¼éªŒè¯</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª å‰åç«¯æ•°æ®æ ¼å¼æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯• 1: å½“å‰ Worker è¿”å›æ ¼å¼ï¼ˆæœªéƒ¨ç½²æ–°ç‰ˆæœ¬ï¼‰</h2>
        <button onclick="testOldFormat()">æµ‹è¯•æ—§æ ¼å¼</button>
        <div id="result1"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯• 2: ä¿®å¤åçš„ Worker è¿”å›æ ¼å¼ï¼ˆæ–°ç‰ˆæœ¬ï¼‰</h2>
        <button onclick="testNewFormat()">æµ‹è¯•æ–°æ ¼å¼</button>
        <div id="result2"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯• 3: å®é™…è°ƒç”¨ Worker API</h2>
        <input type="text" id="testInput" placeholder="è¾“å…¥æµ‹è¯•é¢˜ç›®" value="ä¸€ä¸ªç‰©ä½“ä»é™æ­¢å¼€å§‹è‡ªç”±ä¸‹è½5ç§’" style="width: 100%; padding: 8px; margin-bottom: 10px;">
        <button onclick="testRealAPI()">è°ƒç”¨çœŸå® API</button>
        <div id="result3"></div>
    </div>

    <script>
        const BACKEND_PATH = 'https://physics-visual-worker.yywf08125.workers.dev/api/parse-problem';

        // æ¨¡æ‹Ÿæ—§æ ¼å¼è¿”å›ï¼ˆå½“å‰çº¿ä¸Šç‰ˆæœ¬ï¼‰
        function testOldFormat() {
            const oldResponse = {
                ok: true,
                raw: "MOCK",
                parsed: {
                    type: "uniform",
                    params: { time: 2, g: 10, v0: 0 },
                    reasoning: "Defaulted to free-fall mock."
                }
            };

            const result1 = document.getElementById('result1');
            result1.innerHTML = '<h3>æ—§æ ¼å¼æ•°æ®ï¼š</h3><pre>' + JSON.stringify(oldResponse, null, 2) + '</pre>';
            
            // æµ‹è¯•å‰ç«¯å¤„ç†
            if (oldResponse.success) {
                result1.innerHTML += '<div class="success">âœ“ å‰ç«¯ä¼šè¯†åˆ«ä¸ºæˆåŠŸ</div>';
            } else {
                result1.innerHTML += '<div class="error">âœ— å‰ç«¯ä¼šè¯†åˆ«ä¸ºå¤±è´¥ï¼ˆå› ä¸ºæ²¡æœ‰ success å­—æ®µï¼‰</div>';
                result1.innerHTML += '<p><strong>é—®é¢˜ï¼š</strong>å‰ç«¯æœŸæœ› result.success ä¸º true</p>';
            }
        }

        // æ¨¡æ‹Ÿæ–°æ ¼å¼è¿”å›ï¼ˆä¿®å¤åç‰ˆæœ¬ï¼‰
        function testNewFormat() {
            const newResponse = {
                success: true,
                type: "uniform",
                params: { v0: 0, a: 10, time: 5 },
                reasoning: "é»˜è®¤ä¸ºè‡ªç”±è½ä½“ï¼ˆåŒ€å˜é€Ÿç›´çº¿è¿åŠ¨ï¼‰ã€‚"
            };

            const result2 = document.getElementById('result2');
            result2.innerHTML = '<h3>æ–°æ ¼å¼æ•°æ®ï¼š</h3><pre>' + JSON.stringify(newResponse, null, 2) + '</pre>';
            
            // æµ‹è¯•å‰ç«¯å¤„ç†
            if (newResponse.success) {
                result2.innerHTML += '<div class="success">âœ“ å‰ç«¯ä¼šè¯†åˆ«ä¸ºæˆåŠŸ</div>';
                result2.innerHTML += '<p><strong>ç±»å‹ï¼š</strong>' + newResponse.type + '</p>';
                result2.innerHTML += '<p><strong>å‚æ•°ï¼š</strong>' + JSON.stringify(newResponse.params) + '</p>';
                result2.innerHTML += '<p><strong>è¯´æ˜ï¼š</strong>' + newResponse.reasoning + '</p>';
            } else {
                result2.innerHTML += '<div class="error">âœ— å‰ç«¯ä¼šè¯†åˆ«ä¸ºå¤±è´¥</div>';
            }
        }

        // æµ‹è¯•çœŸå® API
        async function testRealAPI() {
            const result3 = document.getElementById('result3');
            const testInput = document.getElementById('testInput').value;
            
            result3.innerHTML = '<p>æ­£åœ¨è°ƒç”¨ API...</p>';
            
            try {
                const response = await fetch(BACKEND_PATH, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ description: testInput })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                
                result3.innerHTML = '<h3>å®é™… API è¿”å›ï¼š</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                
                // æ£€æŸ¥æ ¼å¼
                if (data.success !== undefined) {
                    result3.innerHTML += '<div class="success">âœ“ ä½¿ç”¨æ–°æ ¼å¼ï¼ˆæœ‰ success å­—æ®µï¼‰</div>';
                    if (data.success) {
                        result3.innerHTML += '<p><strong>çŠ¶æ€ï¼š</strong>è§£ææˆåŠŸ</p>';
                        result3.innerHTML += '<p><strong>ç±»å‹ï¼š</strong>' + data.type + '</p>';
                        result3.innerHTML += '<p><strong>å‚æ•°ï¼š</strong>' + JSON.stringify(data.params) + '</p>';
                    }
                } else if (data.ok !== undefined) {
                    result3.innerHTML += '<div class="error">âœ— ä½¿ç”¨æ—§æ ¼å¼ï¼ˆæœ‰ ok å­—æ®µï¼‰</div>';
                    result3.innerHTML += '<p><strong>é—®é¢˜ï¼š</strong>Worker è¿˜æœªéƒ¨ç½²æ–°ç‰ˆæœ¬ï¼Œéœ€è¦è¿è¡Œ <code>wrangler deploy</code></p>';
                    result3.innerHTML += '<p><strong>åŸå› ï¼š</strong>å‰ç«¯ä»£ç æ£€æŸ¥ result.successï¼Œä½† API è¿”å› result.ok</p>';
                }
                
            } catch (error) {
                result3.innerHTML += '<div class="error">âœ— API è°ƒç”¨å¤±è´¥</div>';
                result3.innerHTML += '<p><strong>é”™è¯¯ï¼š</strong>' + error.message + '</p>';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            testOldFormat();
            testNewFormat();
        };
    </script>
</body>
</html>
