# 导出动画功能使用指南

## 📦 功能概述

物理可视化平台现在支持将动画导出为两种格式：
- **WebM 视频** (类似MP4，浏览器原生支持)
- **GIF 动图** (适合分享)

## 🎯 使用步骤

### 1. 生成动画
```
输入物理问题 → 点击"生成可视化" → 查看动画
```

### 2. 导出动画
1. 点击控制面板右侧的绿色 **"导出动画"** 按钮
2. 在弹出菜单中选择格式：
   - **导出为 MP4** (实际为WebM格式)
   - **导出为 GIF**

### 3. 等待处理
- **WebM**: 自动播放并录制完整动画（3-10秒）
- **GIF**: 捕获帧并渲染（10-30秒，取决于时长）

### 4. 自动下载
文件会自动下载到您的"下载"文件夹：
- `physics-animation-1234567890.webm`
- `physics-animation-1234567890.gif`

## 🎨 格式对比

### WebM 视频 (.webm)
✅ **优点**
- 高质量（30 FPS流畅播放）
- 文件较小（高压缩率）
- 无损画质
- 支持长时间动画

❌ **缺点**
- 某些设备可能不支持直接播放
- 需要VLC、Chrome等播放器

**适用场景**: 演示、教学、存档

### GIF 动图 (.gif)
✅ **优点**
- 通用兼容性（所有设备）
- 可直接在网页/社交媒体显示
- 无需播放器
- 循环播放

❌ **缺点**
- 文件较大
- 帧率较低（20 FPS）
- 颜色限制（256色）
- 不适合长动画（限制100帧）

**适用场景**: 分享、展示、社交媒体

## 💡 使用技巧

### 1. 优化导出时长
- 短动画（3-5秒）: 适合GIF
- 长动画（5秒以上）: 建议WebM

### 2. 提高导出质量
- 在全屏模式下导出画质更好
- 确保动画播放流畅后再导出
- GIF建议在普通模式下导出（文件更小）

### 3. 处理导出文件
**WebM转MP4** (如需要)：
- 使用在线工具：https://convertio.co/zh/webm-mp4/
- 或使用 FFmpeg：`ffmpeg -i input.webm output.mp4`

**GIF优化** (减小文件)：
- 使用 EZGIF: https://ezgif.com/optimize
- 或使用 Photoshop

## 🔧 技术细节

### WebM录制参数
```javascript
{
  fps: 30,
  codec: 'vp9' (或 'vp8'),
  bitrate: 2500000 (2.5 Mbps)
}
```

### GIF生成参数
```javascript
{
  fps: 20,
  quality: 10 (0-30, 越小越好),
  maxFrames: 100,
  workers: 2
}
```

### 自动时长估算
- **自由落体**: `t = √(2h/g) × 2`
- **抛体运动**: `t = 2v₀sinθ/g × 1.5`
- **圆周运动**: `t = 2周期`
- **其他**: 默认5秒

## ⚠️ 注意事项

1. **浏览器兼容性**
   - Chrome/Edge: ✅ 完全支持
   - Firefox: ✅ 完全支持
   - Safari: ⚠️ WebM可能不支持（使用GIF）

2. **性能要求**
   - GIF生成需要一定时间（10-30秒）
   - 长动画会生成较大的文件
   - 建议在性能较好的设备上导出

3. **文件大小**
   - WebM: 通常 500KB - 2MB
   - GIF: 通常 1MB - 5MB

4. **已知问题**
   - GIF可能在生成时页面暂时无响应（正常）
   - 某些复杂动画GIF可能丢帧
   - WebM在某些旧设备上可能无法播放

## 🎬 示例流程

### 导出抛体运动为GIF
```
1. 输入: "一个小球以15m/s的速度与水平成30度角抛出"
2. 点击"生成可视化"
3. 点击"导出动画" → "导出为 GIF"
4. 等待20秒左右
5. GIF自动下载
6. 用于PPT或分享
```

### 导出自由落体为视频
```
1. 输入: "一个物体从10米高处自由落体"
2. 点击"生成可视化"
3. 点击"导出动画" → "导出为 MP4"
4. 等待5秒自动录制
5. WebM文件下载
6. 用VLC播放或转换为MP4
```

## 🚀 快捷键

目前暂无快捷键，计划未来添加：
- `Ctrl+E`: 打开导出菜单
- `Ctrl+Shift+V`: 导出视频
- `Ctrl+Shift+G`: 导出GIF

## 📞 问题反馈

如果遇到问题：
1. 按 F12 打开浏览器控制台查看错误
2. 检查gif.js库是否正常加载
3. 尝试刷新页面重试
4. 更换浏览器（推荐Chrome）

## 🎉 更新日志

**v1.0.3 (2025-01-21)**
- ✨ 完善WebM导出功能
- ✨ 优化GIF生成算法
- ✨ 添加进度提示
- ✨ 智能时长估算
- ✨ 错误处理和用户提示
- 🐛 修复多次导出状态问题
- 🐛 修复GIF帧数过多问题

---

享受您的物理动画导出功能！🎊
