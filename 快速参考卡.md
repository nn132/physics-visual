# ç‰©ç†å¯è§†åŒ–å¹³å° - å¿«é€Ÿå‚è€ƒå¡          

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½é€ŸæŸ¥                    !å¼€å¤´ä¸ºå·²éªŒè¯ï¼Œ@å¼€å¤´ä¸ºæœªå®ç°

### ğŸ“¥ é¢˜ç›®å¯¼å…¥æ–¹å¼
```
!1. æ–‡æœ¬è¾“å…¥ â†’ #problem-description è¾“å…¥æ¡†
!2. Wordä¸Šä¼  â†’ #upload-docx æŒ‰é’®ï¼ˆMammoth.jsè§£æï¼‰
!3. å›¾ç‰‡ä¸Šä¼  â†’ #upload-image æŒ‰é’®ï¼ˆéœ€OCRåç«¯ï¼‰
```

### ğŸ§  AIè§£ææµç¨‹
```
ç‚¹å‡»"æ™ºèƒ½è§£æ" 
  â†’ parseDescriptionWithAI(text)
  â†’ Cloudflare Worker (DeepSeek API)
  â†’ è¿”å› {type, params, reasoning, sceneDescription}
  â†’ fillFormFromAI(type, params)
 ! â†’ å‚æ•°å¡«å…¥è¡¨å•
```

@@### ğŸ¬ ç”Ÿæˆå¯è§†åŒ–æµç¨‹
```
ç‚¹å‡»"ç”Ÿæˆå¯è§†åŒ–"
  â†’ getParams() è¯»å–å‚æ•°
  â†’ sceneParams = params
  â†’ drawScene() ç»˜åˆ¶åˆå§‹å¸§
  â†’ ç‚¹å‡»"æ’­æ”¾" â†’ animate() å¾ªç¯
```

---

## ğŸ”‘ å…³é”®å‡½æ•°é€ŸæŸ¥è¡¨

| åŠŸèƒ½ | å‡½æ•°å | è¡Œå· | ç”¨é€” |
|-----|-------|------|------|
| **Canvasæ¸²æŸ“** | `drawScene()` | ~1200 | ä¸»è°ƒåº¦å‡½æ•°ï¼Œæ ¹æ®é¢˜å‹åˆ†å‘ |
| | `drawHorizontalMotion()` | ~2277 | æ°´å¹³è¿åŠ¨ï¼ˆæ±½è½¦ï¼‰ |
| | `drawCircularMotion()` | ~2620 | åœ†å‘¨è¿åŠ¨ |
| **åŠ¨ç”»æ§åˆ¶** | `startAnimation()` | 1367 | å¼€å§‹æ’­æ”¾ |
| | `pauseAnimation()` | 1405 | æš‚åœæ’­æ”¾ |
| | `resetAnimation()` | 1421 | é‡ç½®åˆ°t=0 |
| | `animate()` | ~1500 | åŠ¨ç”»ä¸»å¾ªç¯ |
| **å‚æ•°ç®¡ç†** | `getParams()` | 2840 | è·å–å‚æ•°ï¼ˆAIä¼˜å…ˆï¼‰ |
| | `populateParamsForType()` | 3001 | åŠ¨æ€ç”Ÿæˆè¾“å…¥æ¡† |
| | `fillFormFromAI()` | 3520 | AIç»“æœå¡«è¡¨å• |
| **AIè§£æ** | `parseDescriptionWithAI()` | 3408 | è°ƒç”¨åç«¯API |
| | `parseLocalFallbackImproved()` | 3270 | æœ¬åœ°æ­£åˆ™å¤‡ç”¨ |
| **å¯¼å‡ºåŠŸèƒ½** | `exportGIF()` | ~3900 | å¯¼å‡ºGIF |
| | `exportCSV()` | ~4000 | å¯¼å‡ºè¿åŠ¨æ•°æ® |

---

## ğŸ¨ æ”¯æŒçš„ç‰©ç†åœºæ™¯

| é¢˜å‹ | typeå€¼ | å‚æ•° | ç‰©ç†å…¬å¼ |
|-----|--------|------|---------|
| åŒ€å˜é€Ÿè¿åŠ¨ | `uniform` | v0, a, time | s=v0*t+Â½atÂ² |
| æŠ›ä½“è¿åŠ¨ | `projectile` | speed, angle, height | x=v0cosÎ¸*t, y=h+v0sinÎ¸*t-Â½gtÂ² |
| åœ†å‘¨è¿åŠ¨ | `circular` | radius, angular | x=r*cos(Ï‰t), y=r*sin(Ï‰t) |
| ç¢°æ’è¿åŠ¨ | `collision` | m1,v1,m2,v2 | åŠ¨é‡å®ˆæ’ã€èƒ½é‡å®ˆæ’ |
| ç£åœºè¿åŠ¨ | `magnetic` | q, v, B | æ´›ä¼¦å…¹åŠ›ã€åœ†å‘¨è¿åŠ¨ |
| å¤©ä½“è¿åŠ¨ | `astrodynamics` | M, r | ä¸‡æœ‰å¼•åŠ› |

---

## ğŸ”§ å¸¸ç”¨DOMå…ƒç´ ID

### è¾“å…¥åŒº
- `#problem-description` - é¢˜ç›®æ–‡æœ¬è¾“å…¥æ¡†
- `#question-type-select` - é¢˜å‹é€‰æ‹©ä¸‹æ‹‰æ¡†
- `#dynamic-params` - åŠ¨æ€å‚æ•°å®¹å™¨
- `#input-initial-velocity` - åˆé€Ÿåº¦è¾“å…¥æ¡†
- `#input-acceleration` - åŠ é€Ÿåº¦è¾“å…¥æ¡†
- `#input-time` - æ—¶é—´è¾“å…¥æ¡†

### CanvasåŒº
- `#physics-canvas` - Canvasç”»å¸ƒ
- `#animation-container` - Canvaså®¹å™¨
- `#animation-time` - æ—¶é—´æ˜¾ç¤º
- `#animation-velocity` - é€Ÿåº¦æ˜¾ç¤º
- `#animation-position` - ä½ç½®æ˜¾ç¤º

### æ§åˆ¶æŒ‰é’®
- `#generate-animation` - ç”Ÿæˆå¯è§†åŒ–
- `#play-animation` - æ’­æ”¾
- `#pause-animation` - æš‚åœ
- `#reset-animation` - é‡ç½®
- `#animation-speed` - é€Ÿåº¦æ»‘å—

---

## ğŸ’¾ å…¨å±€å˜é‡é€ŸæŸ¥

### æ ¸å¿ƒçŠ¶æ€
```javascript
sceneParams        // å½“å‰åœºæ™¯å‚æ•° {type, v0, a, ...}
currentTime        // åŠ¨ç”»æ—¶é—´ï¼ˆç§’ï¼‰
isPlaying          // æ˜¯å¦æ’­æ”¾ä¸­
canvas, ctx        // Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
```

### AIç›¸å…³
```javascript
window._aiParsedParams     // AIå‚æ•°ç¼“å­˜ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
aiGeneratedScene           // AIå®Œæ•´åœºæ™¯æè¿°
window.MOTION_DIRECTION    // è¿åŠ¨æ–¹å‘ï¼ˆhorizontal/verticalï¼‰
```

### é…ç½®
```javascript
const BACKEND_PATH = 'https://physics-visual-worker.yywf08125.workers.dev/api/parse-problem';
const gravity = 10;        // é»˜è®¤é‡åŠ›åŠ é€Ÿåº¦
```

---

## ğŸ› è°ƒè¯•å‘½ä»¤é€ŸæŸ¥

### æµè§ˆå™¨æ§åˆ¶å°
```javascript
// æŸ¥çœ‹å½“å‰å‚æ•°
sceneParams

// æŸ¥çœ‹AIç¼“å­˜
window._aiParsedParams

// æ‰‹åŠ¨è®¾ç½®å‚æ•°
sceneParams = {type: 'uniform', v0: 0, a: 2, time: 3}

// é‡ç»˜åœºæ™¯
drawScene()

// æ‰‹åŠ¨æ’­æ”¾
startAnimation()

// æŸ¥çœ‹Canvasä¸Šä¸‹æ–‡
ctx

// æŸ¥çœ‹å›¾è¡¨å®ä¾‹
window.chartPosition
window.chartVelocity
```

### æŸ¥çœ‹æ—¥å¿—å…³é”®è¯
```
ğŸŒ å¼€å§‹è¯·æ±‚åç«¯     - AIè¯·æ±‚å¼€å§‹
âœ… åç«¯è¿”å›æ•°æ®     - AIè¿”å›æˆåŠŸ
âœ¨ ä½¿ç”¨AIè§£æçš„å‚æ•°  - ä¼˜å…ˆä½¿ç”¨AIå‚æ•°
ğŸ“ ä»è¡¨å•è¯»å–å‚æ•°    - ä½¿ç”¨è¡¨å•å€¼
ğŸ¨ drawScene() è¢«è°ƒç”¨ - Canvasæ¸²æŸ“
â–¶ï¸ å¼€å§‹æ’­æ”¾åŠ¨ç”»     - åŠ¨ç”»å¼€å§‹
```

---

## ğŸ”„ å‚æ•°ä¼˜å…ˆçº§æœºåˆ¶

```
getParams() è°ƒç”¨
    â†“
å­˜åœ¨ window._aiParsedParams ?
    â”œâ”€ YES â†’ ä½¿ç”¨AIå‚æ•°ï¼ˆå¿½ç•¥è¡¨å•é»˜è®¤å€¼ï¼‰âœ¨
    â””â”€ NO  â†’ è¯»å–è¡¨å•å½“å‰å€¼ ğŸ“

è§¦å‘æ¸…é™¤ _aiParsedParams çš„æ“ä½œï¼š
  âœï¸ ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹ä»»ä½•è¾“å…¥æ¡†
  ğŸ”„ ç”¨æˆ·åˆ‡æ¢é¢˜å‹
```

**ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæœºåˆ¶ï¼Ÿ**
- é—®é¢˜ï¼šåœ†å‘¨è¿åŠ¨è¡¨å•é»˜è®¤ radius=2, angular=1
- å¦‚æœAIè§£æå‡º radius=5ï¼Œä½†ç›´æ¥è¯»è¡¨å•ä¼šå¾—åˆ°é»˜è®¤å€¼2
- è§£å†³ï¼šAIè§£æåä¿å­˜åˆ° `_aiParsedParams`ï¼Œä¼˜å…ˆä½¿ç”¨

---

## ğŸ“Š æ·»åŠ æ–°ç‰©ç†åœºæ™¯çš„æ­¥éª¤

### 1. HTMLæ·»åŠ é€‰é¡¹
```html
<option value="mymotion">æˆ‘çš„è¿åŠ¨</option>
```

### 2. å®šä¹‰å‚æ•°å­—æ®µ
```javascript
// populateParamsForType() ä¸­
else if (type === 'mymotion') {
  dynamicParams.appendChild(createParamField('input-myParam', 'æˆ‘çš„å‚æ•°', '10'));
}
```

### 3. è¯»å–å‚æ•°
```javascript
// getParams() ä¸­
if (type === 'mymotion') {
  params.myParam = parseFloat(...);
}
```

### 4. æ·»åŠ ç»˜åˆ¶é€»è¾‘
```javascript
// drawScene() ä¸­
case 'mymotion':
  drawMyMotion();
  break;

// å®ç°ç»˜åˆ¶å‡½æ•°
function drawMyMotion() {
  const myParam = sceneParams.myParam;
  // ç»˜åˆ¶ä»£ç ...
}
```

### 5. æ›´æ–°AIåç«¯æç¤ºè¯
ä¿®æ”¹ `backend/worker/index.js` çš„ `SYSTEM_PROMPT`ï¼Œæ·»åŠ æ–°é¢˜å‹è¯´æ˜ã€‚

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

- [ ] SVGå›¾åƒå·²ç¼“å­˜ï¼ˆ`window._carImageCache`ï¼‰
- [ ] ä½¿ç”¨ `requestAnimationFrame` è€Œé `setInterval`
- [ ] Canvaså°ºå¯¸åˆç†ï¼ˆé¿å…è¿‡å¤§ï¼‰
- [ ] å›¾è¡¨æ•°æ®ç‚¹æ•°é‡æ§åˆ¶ï¼ˆé¿å…è¿‡å¤šï¼‰
- [ ] AIè¯·æ±‚æœ‰è¶…æ—¶æ§åˆ¶ï¼ˆ30ç§’ï¼‰
- [ ] è¾“å…¥äº‹ä»¶ä½¿ç”¨debounce

---

## ğŸ“ å¸¸è§é—®é¢˜æ’æŸ¥

### âŒ AIè§£æè¿”å›é”™è¯¯å‚æ•°
1. æ£€æŸ¥åç«¯åœ°å€ï¼š`BACKEND_PATH`
2. æŸ¥çœ‹Networkæ ‡ç­¾ï¼Œæ£€æŸ¥å“åº”
3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š`âœ… åç«¯è¿”å›æ•°æ®`
4. æµ‹è¯•æœ¬åœ°fallbackæ˜¯å¦æ­£å¸¸

### âŒ Canvasä¸æ˜¾ç¤º
1. æ£€æŸ¥ `#physics-canvas` å…ƒç´ æ˜¯å¦å­˜åœ¨
2. æŸ¥çœ‹æ§åˆ¶å°ï¼š`ğŸ¨ drawScene() è¢«è°ƒç”¨`
3. æ£€æŸ¥ `sceneParams` æ˜¯å¦å·²è®¾ç½®
4. è°ƒç”¨ `drawScene()` æ‰‹åŠ¨è§¦å‘

### âŒ åŠ¨ç”»ä¸æ’­æ”¾
1. æ£€æŸ¥ `isPlaying` çŠ¶æ€
2. æŸ¥çœ‹æ§åˆ¶å°ï¼š`â–¶ï¸ å¼€å§‹æ’­æ”¾åŠ¨ç”»`
3. æ£€æŸ¥æ˜¯å¦æœ‰JavaScripté”™è¯¯é˜»å¡
4. æ‰‹åŠ¨è°ƒç”¨ `startAnimation()`

### âŒ å‚æ•°ä¸æ­£ç¡®
1. æ§åˆ¶å°æŸ¥çœ‹ï¼š`âœ¨ ä½¿ç”¨AIè§£æçš„å‚æ•°` æˆ– `ğŸ“ ä»è¡¨å•è¯»å–å‚æ•°`
2. æ£€æŸ¥ `window._aiParsedParams`
3. æ£€æŸ¥è¡¨å•è¾“å…¥æ¡†IDæ˜¯å¦æ­£ç¡®
4. æ‰‹åŠ¨è®¾ç½® `sceneParams` æµ‹è¯•

---

## ğŸ“š ç›¸å…³èµ„æº

- **å®Œæ•´å¯¼èˆª**ï¼š`ä»£ç ç»“æ„å¯¼èˆª.md`
- **AIé…ç½®**ï¼š`DEEPSEEK_é…ç½®æŒ‡å—.md`
- **åç«¯ä»£ç **ï¼š`backend/worker/index.js`
- **æµ‹è¯•è„šæœ¬**ï¼š`test-deepseek-prompt.js`

---

**å¿«é€Ÿå¯åŠ¨å‘½ä»¤**ï¼š
```powershell
# æ‰“å¼€ä¸»é¡µé¢
ii index1.0.3.html

# æœ¬åœ°æµ‹è¯•AIï¼ˆéœ€Node.jsï¼‰
$env:DEEPSEEK_API_KEY="sk-xxx"
node test-deepseek-prompt.js
```
