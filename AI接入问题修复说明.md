# AI 接入问题修复说明

## 🔍 问题诊断

### 当前状态
- ✅ DeepSeek API 已配置（https://api.deepseek.com）
- ✅ Worker 已部署（physics-visual-worker.yywf08125.workers.dev）
- ✅ 前端代码已接入 AI（parseDescriptionWithAI 函数）
- ❌ **但是 AI 理解错误！**

### 核心问题
**DeepSeek 混淆了"初速度"和"加速度"概念！**

**测试题目**：
```
一辆汽车由静止开始以2m/s²的加速度匀加速前进，经过3秒后速度是多少？
```

**期望结果**：
```json
{
  "type": "uniform",
  "params": {
    "v0": 0,    // 由静止 → 初速度 0
    "a": 2,     // 加速度 2m/s²
    "time": 3
  }
}
```

**实际返回**：
```json
{
  "type": "uniform",
  "params": {
    "v0": 2,    // ❌ 错误！把加速度理解成了初速度
    "a": 0,     // ❌ 错误！把"由静止"理解成了匀速
    "time": 3
  }
}
```

---

## ✅ 解决方案

### 1. 更新 Worker 提示词（已完成）

**修改文件**：`backend/worker/index.js`

**关键改进**：
- 用中文重写提示词（更清晰）
- 明确区分"初速度"和"加速度"概念
- 添加详细的单位说明（m/s vs m/s²）
- 增加 2 个示例（匀加速 + 匀速）

**新提示词**：
```javascript
const SYSTEM_PROMPT = `你是一个专业的物理题目分析器。你的任务是从中文物理题目中提取**精确的数值参数**。

【核心原则】
1. **精确提取**题目中明确给出的数字
2. **物理概念区分**（这非常重要！）：
   - "初速度" vs "加速度"：绝对不能混淆！
   - "由静止开始" = 初速度v0=0
   - "加速度为X m/s²" = a=X（注意单位是m/s²，不是m/s）
   - "以X m/s的速度" = 初速度v0=X（单位是m/s）
...
【示例1】
输入: "一辆汽车由静止开始以2m/s²的加速度匀加速前进，经过3秒后速度是多少？"
输出: {"type":"uniform","params":{"v0":0,"a":2,"time":3},...}
`;
```

### 2. 手动部署到 Cloudflare（需要您操作）

**步骤**：
1. 打开 https://dash.cloudflare.com/
2. 进入 Workers & Pages
3. 点击 `physics-visual-worker`
4. 点击 "Edit Code" 或 "Quick edit"
5. **完整替换**代码为 `backend/worker/index.js` 的内容
6. 点击 "Save and Deploy"

**为什么要手动部署？**
- `wrangler deploy` 命令遇到 OAuth 超时
- 手动部署更快速、更可靠

---

## 🧪 测试验证

### 方法 1：本地脚本测试（推荐）

运行测试脚本（需要 Node.js）：

```powershell
# 设置 API Key（替换为您的真实 Key）
$env:DEEPSEEK_API_KEY="sk-xxxxxxxxxxxx"

# 运行测试
node test-deepseek-prompt.js
```

**预期输出**：
```
🚀 开始测试 DeepSeek 提示词...

============================================================
📝 测试1：匀加速（从静止，a=2）
📥 输入: "一辆汽车由静止开始以2m/s²的加速度匀加速前进，经过3秒后速度是多少？"
🎯 期望: {"type":"uniform","params":{"v0":0,"a":2,"time":3}}
📤 实际: {"type":"uniform","params":{"v0":0,"a":2,"time":3}}
✅ 测试通过！

============================================================
📝 测试2：匀速（v0=10）
📥 输入: "一个物体以10m/s的速度做匀速直线运动，5秒后位移是多少？"
🎯 期望: {"type":"uniform","params":{"v0":10,"a":0,"time":5}}
📤 实际: {"type":"uniform","params":{"v0":10,"a":0,"time":5}}
✅ 测试通过！
```

### 方法 2：浏览器测试

1. 打开 `index1.0.3.html`
2. 在题目描述框输入：
   ```
   一辆汽车由静止开始以2m/s²的加速度匀加速前进，经过3秒后速度是多少？
   ```
3. 点击"智能解析"
4. **检查参数**：
   - 初速度应该是 `0`
   - 加速度应该是 `2`
   - 时间应该是 `3`
5. 点击"生成可视化"
6. **验证运动**：
   - 3 秒后速度 = 6 m/s（0 + 2×3）
   - 3 秒后位移 = 9 m（½×2×3²）

---

## 📊 对比：修复前 vs 修复后

| 项目 | 修复前 | 修复后 |
|------|-------|-------|
| **提示词语言** | 英文 | 中文（更清晰） |
| **示例数量** | 1 个 | 2 个（匀加速+匀速） |
| **概念区分** | 模糊 | 明确区分 v0 vs a |
| **单位说明** | 无 | 详细说明 m/s vs m/s² |
| **测试结果** | ❌ v0=2, a=0（错误） | ✅ v0=0, a=2（正确） |

---

## 🚀 下一步计划

### 短期（立即）
1. ✅ 修复提示词（已完成）
2. ⏳ **部署到 Cloudflare**（您需要手动操作）
3. ⏳ 运行测试验证

### 中期（本周）
1. 添加更多测试用例（抛体、圆周等）
2. 优化前端交互（显示 AI 推理过程）
3. 完善错误提示

### 长期（本月）
1. 实现"AI 智能模型选择器"
2. 扩展模型库（球、滑块、弹簧等）
3. 支持更多物理场景

---

## 💡 核心要点

**为什么 AI 会理解错？**
- 原提示词是英文，DeepSeek 理解不够准确
- 缺少明确的单位区分（m/s vs m/s²）
- 示例太少，模型无法充分学习

**如何避免类似问题？**
1. 使用中文提示词（针对中文题目）
2. 提供多个清晰示例
3. 明确说明容易混淆的概念
4. 增加本地测试脚本（快速验证）

---

## 📞 需要帮助？

如果部署后仍有问题，请：
1. 运行 `node test-deepseek-prompt.js` 查看本地测试结果
2. 打开浏览器控制台，查看网络请求
3. 检查 Worker 日志（Cloudflare Dashboard → Logs）
