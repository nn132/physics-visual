# ç‰©ç†å¯è§†åŒ–å­¦ä¹ å¹³å° - ä»£ç ç»“æ„å¯¼èˆª

## ğŸ“š æ–‡ä»¶æ¦‚è§ˆ

- **ä¸»æ–‡ä»¶**: `index1.0.3.html` (çº¦4100è¡Œ)
- **æ¶æ„**: å•æ–‡ä»¶åº”ç”¨ï¼ˆHTML + CSS + JavaScriptï¼‰
- **ä¾èµ–åº“**: Tailwind CSS, Chart.js, Mammoth.js, gifshot.js

---

## ğŸ—ºï¸ ä»£ç æ¨¡å—å¯¼èˆªï¼ˆæŒ‰è¡Œå·ï¼‰

### 1ï¸âƒ£ HTMLå¤´éƒ¨ä¸é…ç½® (è¡Œ 1-1092)

| è¡Œå·èŒƒå›´ | æ¨¡å—åç§° | è¯´æ˜ |
|---------|---------|------|
| 1-70 | æ–‡æ¡£å¤´éƒ¨ | DOCTYPE, metaæ ‡ç­¾, å¤–éƒ¨åº“å¼•å…¥ |
| 70-97 | Tailwindé…ç½® | ä¸»é¢˜é¢œè‰²ã€å­—ä½“é…ç½® |
| 97-115 | è¾…åŠ©å·¥å…·å‡½æ•° | roundRect, drawWheel, shadeColor, getCarImage |
| 115-400 | è‡ªå®šä¹‰æ ·å¼ | CSSåŠ¨ç”»ã€fullscreenæ ·å¼ |
| 400-1092 | HTMLç»“æ„ | å¯¼èˆªæ ã€ä¾§è¾¹æ ã€Canvaså®¹å™¨ã€åº•éƒ¨æ§åˆ¶æŒ‰é’® |

**æ ¸å¿ƒUIå…ƒç´ IDï¼š**
- `#physics-canvas` - Canvasç”»å¸ƒ
- `#animation-container` - Canvaså®¹å™¨
- `#question-type-select` - é¢˜å‹é€‰æ‹©ä¸‹æ‹‰æ¡†
- `#dynamic-params` - åŠ¨æ€å‚æ•°è¾“å…¥åŒº
- `#problem-description` - é¢˜ç›®æ–‡æœ¬è¾“å…¥æ¡†
- `#generate-animation` - ç”Ÿæˆå¯è§†åŒ–æŒ‰é’®
- `#play-animation` / `#pause-animation` - æ’­æ”¾/æš‚åœæŒ‰é’®

---

### 2ï¸âƒ£ JavaScriptä¸»ä»£ç  (è¡Œ 1093-4100+)

#### ğŸ“¦ å…¨å±€å˜é‡å®šä¹‰ (è¡Œ 1093-1170)

```javascript
// Canvas ç›¸å…³
let canvas, ctx;                    // Canvaså…ƒç´ å’Œ2Dç»˜å›¾ä¸Šä¸‹æ–‡
let animationFrameId = null;        // requestAnimationFrameçš„ID
let currentTime = 0;                // å½“å‰åŠ¨ç”»æ—¶é—´ï¼ˆç§’ï¼‰
let isPlaying = false;              // æ˜¯å¦æ­£åœ¨æ’­æ”¾
let sceneParams = null;             // åœºæ™¯ç‰©ç†å‚æ•°

// DOMå…ƒç´ å¼•ç”¨
let animationContainer;
let questionTypeSelect;
let generateButton;
let playBtn, pauseBtn;
```

---

#### ğŸ¨ Canvasæ¸²æŸ“å¼•æ“ (è¡Œ 1170-2700)

| å‡½æ•°å | è¡Œå· | åŠŸèƒ½è¯´æ˜ |
|-------|------|---------|
| `initCanvas()` | ~1170 | åˆå§‹åŒ–Canvasä¸Šä¸‹æ–‡ï¼Œè®¾ç½®å°ºå¯¸ |
| `drawScene()` | ~1200 | **ä¸»è°ƒåº¦å‡½æ•°**ï¼Œæ ¹æ®é¢˜å‹åˆ†å‘åˆ°å¯¹åº”ç»˜åˆ¶å‡½æ•° |
| `drawWelcomeScreen()` | ~1250 | ç»˜åˆ¶æ¬¢è¿å±å¹•ï¼ˆæœªç”Ÿæˆåœºæ™¯æ—¶ï¼‰ |
| `drawHorizontalMotion()` | ~2277 | ç»˜åˆ¶æ°´å¹³è¿åŠ¨ï¼ˆæ±½è½¦ã€æ»‘å—ï¼‰ |
| `drawVerticalMotion()` | ~2400 | ç»˜åˆ¶å‚ç›´è¿åŠ¨ï¼ˆè‡ªç”±è½ä½“ï¼‰ |
| `drawProjectileMotion()` | ~2500 | ç»˜åˆ¶æŠ›ä½“è¿åŠ¨ |
| `drawCircularMotion()` | ~2620 | ç»˜åˆ¶åœ†å‘¨è¿åŠ¨ |
| `drawCollision()` | ~2700 | ç»˜åˆ¶ç¢°æ’è¿åŠ¨ |

**å…³é”®æ¸²æŸ“ç‰¹æ€§ï¼š**
- ä½¿ç”¨SVGæ±½è½¦å›¾åƒï¼ˆ`getCarImage()`ï¼‰
- æ”¯æŒå…¨å±æ¨¡å¼è‡ªé€‚åº”
- å®æ—¶æ˜¾ç¤ºæ—¶é—´ã€é€Ÿåº¦ã€ä½ç½®æ•°æ®
- AIåœºæ™¯ä¼šæ˜¾ç¤º"âœ¨ AI ç²¾ç¡®åœºæ™¯"æ ‡è®°

---

#### â–¶ï¸ åŠ¨ç”»æ§åˆ¶ç³»ç»Ÿ (è¡Œ 1365-1500)

| å‡½æ•°å | è¡Œå· | åŠŸèƒ½è¯´æ˜ |
|-------|------|---------|
| `startAnimation()` | 1367 | å¼€å§‹æ’­æ”¾ï¼Œå¯åŠ¨requestAnimationFrameå¾ªç¯ |
| `pauseAnimation()` | 1405 | æš‚åœæ’­æ”¾ï¼Œå–æ¶ˆåŠ¨ç”»å¸§ |
| `resetAnimation()` | 1421 | é‡ç½®åˆ°t=0ï¼Œæ¸…é™¤çŠ¶æ€ |
| `animate()` | ~1500 | åŠ¨ç”»ä¸»å¾ªç¯ï¼Œæ¯å¸§è°ƒç”¨drawScene() |

**åŠ¨ç”»æ—¶é—´æ­¥è¿›ï¼š**
```javascript
currentTime += dt / animationSpeed.value;  // dtæ ¹æ®é¢˜å‹ä¸åŒï¼ˆ0.05-0.1ç§’ï¼‰
```

---

#### ğŸ“ å‚æ•°ç®¡ç†æ¨¡å— (è¡Œ 2830-3050)

| å‡½æ•°å | è¡Œå· | åŠŸèƒ½è¯´æ˜ |
|-------|------|---------|
| `getParams()` | 2840 | **æ ¸å¿ƒå‡½æ•°**ï¼šä»è¡¨å•æˆ–AIç¼“å­˜è·å–å‚æ•° |
| `populateParamsForType()` | 3001 | æ ¹æ®é¢˜å‹åŠ¨æ€ç”Ÿæˆè¾“å…¥æ¡† |
| `createParamField()` | ~2990 | åˆ›å»ºå•ä¸ªå‚æ•°è¾“å…¥æ¡†DOM |

**å‚æ•°ä¼˜å…ˆçº§ï¼š**
1. `window._aiParsedParams` (AIåˆšè§£æå®Œï¼Œä¼˜å…ˆä½¿ç”¨)
2. è¡¨å•è¾“å…¥å€¼ (ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥æˆ–ä¿®æ”¹)

**æ”¯æŒçš„é¢˜å‹ï¼š**
- `uniform` - åŒ€å˜é€Ÿç›´çº¿è¿åŠ¨ (v0, a, time)
- `projectile` - æŠ›ä½“è¿åŠ¨ (speed, angle, height)
- `circular` - åœ†å‘¨è¿åŠ¨ (radius, angular)
- `collision` - ç¢°æ’è¿åŠ¨ (m1, v1, m2, v2)
- `magnetic` - ç£åœºè¿åŠ¨ (q, v, B)
- `astrodynamics` - å¤©ä½“è¿åŠ¨ (M, r)

---

#### ğŸ§  AIè§£ææ¨¡å— (è¡Œ 3400-3700)

| å‡½æ•°å | è¡Œå· | åŠŸèƒ½è¯´æ˜ |
|-------|------|---------|
| `parseDescriptionWithAI()` | 3408 | è°ƒç”¨Cloudflare Workeråç«¯ï¼ˆDeepSeek APIï¼‰ |
| `parseLocalFallbackImproved()` | 3270 | æœ¬åœ°æ­£åˆ™è¡¨è¾¾å¼å¤‡ç”¨è§£æ |
| `fillFormFromAI()` | 3520 | å°†AIç»“æœå¡«å…¥è¡¨å• |

**åç«¯åœ°å€ï¼š**
```javascript
const BACKEND_PATH = 'https://physics-visual-worker.yywf08125.workers.dev/api/parse-problem';
```

**AIè¿”å›æ ¼å¼ï¼š**
```json
{
  "success": true,
  "type": "uniform",
  "params": { "v0": 0, "a": 2, "time": 3 },
  "reasoning": "åŒ€åŠ é€Ÿç›´çº¿è¿åŠ¨ï¼Œç”±é™æ­¢å¼€å§‹...",
  "sceneDescription": {
    "objects": ["æ±½è½¦"],
    "initialConditions": "é™æ­¢å¹¶å¼€å§‹è¿åŠ¨",
    "environment": "ç¬”ç›´å…¬è·¯"
  }
}
```

**Fallbackæœºåˆ¶ï¼š**
- ç½‘ç»œè¶…æ—¶ï¼ˆ30ç§’ï¼‰â†’ æœ¬åœ°è§£æ
- AIè¿”å›å¤±è´¥ â†’ æœ¬åœ°è§£æ
- AIè¿”å›é»˜è®¤å€¼ â†’ æœ¬åœ°è§£æ

---

#### ğŸ“¥ é¢˜ç›®å¯¼å…¥æ¨¡å— (è¡Œ 3700-3850)

| åŠŸèƒ½ | è¡Œå· | è§¦å‘å…ƒç´ ID | è¯´æ˜ |
|-----|------|-----------|------|
| å›¾ç‰‡ä¸Šä¼  | ~3750 | `#upload-image` | éœ€è¦åç«¯OCRï¼ˆæš‚æœªå®ç°ï¼‰ |
| Wordæ–‡æ¡£ä¸Šä¼  | ~3800 | `#upload-docx` | Mammoth.jså®¢æˆ·ç«¯è§£æ |
| æ–‡æœ¬è¾“å…¥ | - | `#problem-description` | ç›´æ¥è¾“å…¥é¢˜ç›®æ–‡æœ¬ |

**Wordè§£æç¤ºä¾‹ï¼š**
```javascript
mammoth.convertToHtml({ arrayBuffer: arrayBuffer })
  .then(result => {
    const html = result.value;
    const text = html.replace(/<[^>]+>/g, '');  // å»é™¤HTMLæ ‡ç­¾
    descriptionEl.value = text;
  });
```

---

#### ğŸ’¾ å¯¼å‡ºåŠŸèƒ½æ¨¡å— (è¡Œ 3850-4050)

| å‡½æ•°å | è¡Œå· | å¯¼å‡ºæ ¼å¼ | è¯´æ˜ |
|-------|------|---------|------|
| `exportGIF()` | ~3900 | GIFåŠ¨ç”» | ä½¿ç”¨gifshot.js |
| `exportMP4()` | ~3950 | MP4è§†é¢‘ | MediaRecorder API |
| `exportCSV()` | ~4000 | CSVæ•°æ® | æ—¶é—´ã€ä½ç½®ã€é€Ÿåº¦ |
| `exportJSON()` | ~4020 | JSONå‚æ•° | åœºæ™¯é…ç½® |

**å¯¼å‡ºæ•°æ®ç»“æ„ï¼š**
```javascript
exportData = [
  { t: 0.05, x: 0.001, y: 0, v: 0.1, type: 'uniform' },
  { t: 0.10, x: 0.004, y: 0, v: 0.2, type: 'uniform' },
  // ...
];
```

---

#### ğŸ“Š å›¾è¡¨æ¨¡å— (è¡Œ 2100-2200)

| å‡½æ•°å | è¡Œå· | åŠŸèƒ½è¯´æ˜ |
|-------|------|---------|
| `initializeUniformCharts()` | ~2100 | åˆå§‹åŒ–s-tå’Œv-tå›¾è¡¨ |
| `appendUniformData()` | ~2150 | è¿½åŠ æ•°æ®ç‚¹åˆ°å›¾è¡¨ |
| `clearUniformCharts()` | ~2180 | æ¸…ç©ºå›¾è¡¨æ•°æ® |

**ä½¿ç”¨Chart.jsåˆ›å»ºï¼š**
```javascript
window.chartPosition = new Chart(ctxPos, {
  type: 'line',
  data: { datasets: [{ label: 'ä½ç§»-æ—¶é—´', data: [] }] }
});
```

---

#### ğŸ–¥ï¸ å…¨å±åŠŸèƒ½ (è¡Œ 1600-1700)

| å‡½æ•°å | è¡Œå· | åŠŸèƒ½è¯´æ˜ |
|-------|------|---------|
| `enterFullscreen()` | ~1650 | è°ƒç”¨Fullscreen APIè¿›å…¥å…¨å± |
| `exitFullscreen()` | ~1680 | é€€å‡ºå…¨å± |

**å…¨å±åˆ‡æ¢ï¼š**
```javascript
animationContainer.requestFullscreen();
document.exitFullscreen();
```

---

## ğŸ”§ å…³é”®å…¨å±€å˜é‡

### å‚æ•°ç›¸å…³
```javascript
window._aiParsedParams      // AIè§£æçš„å‚æ•°ç¼“å­˜ï¼ˆé˜²æ­¢è¡¨å•é»˜è®¤å€¼å¹²æ‰°ï¼‰
window.MOTION_DIRECTION     // è¿åŠ¨æ–¹å‘ï¼ˆhorizontal/verticalï¼‰
window.GRAVITY_OVERRIDE     // é‡åŠ›åŠ é€Ÿåº¦è¦†ç›–å€¼
aiGeneratedScene            // AIå®Œæ•´åœºæ™¯æè¿°
```

### Canvasç›¸å…³
```javascript
sceneParams                 // å½“å‰åœºæ™¯å‚æ•° {type, v0, a, time, ...}
currentTime                 // å½“å‰åŠ¨ç”»æ—¶é—´ï¼ˆç§’ï¼‰
isPlaying                   // æ’­æ”¾çŠ¶æ€
animationFrameId            // requestAnimationFrame ID
```

### å›¾è¡¨ç›¸å…³
```javascript
window.chartPosition        // s-tå›¾è¡¨å®ä¾‹
window.chartVelocity        // v-tå›¾è¡¨å®ä¾‹
```

---

## ğŸ”„ å…¸å‹å·¥ä½œæµç¨‹

### 1. ç”¨æˆ·è¾“å…¥é¢˜ç›® â†’ AIè§£æ â†’ ç”Ÿæˆå¯è§†åŒ–

```
ç”¨æˆ·ç‚¹å‡»"æ™ºèƒ½è§£æ" 
  â†“
parseDescriptionWithAI(text)
  â†“ (è°ƒç”¨åç«¯)
Cloudflare Worker â†’ DeepSeek API
  â†“ (è¿”å›ç»“æ„åŒ–å‚æ•°)
fillFormFromAI(type, params)
  â†“ (å¡«å……è¡¨å•)
ç”¨æˆ·ç‚¹å‡»"ç”Ÿæˆå¯è§†åŒ–"
  â†“
getParams() â†’ sceneParams
  â†“
drawScene() â†’ åˆ†å‘åˆ°å¯¹åº”ç»˜åˆ¶å‡½æ•°
  â†“
ç”¨æˆ·ç‚¹å‡»"æ’­æ”¾"
  â†“
startAnimation() â†’ animate() å¾ªç¯
```

### 2. å‚æ•°ä¼˜å…ˆçº§æœºåˆ¶

```
getParams() è¢«è°ƒç”¨
  â†“
æ£€æŸ¥ window._aiParsedParams æ˜¯å¦å­˜åœ¨ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ è¿”å›AIå‚æ•°ï¼ˆå¿½ç•¥è¡¨å•é»˜è®¤å€¼ï¼‰
  â””â”€ å¦ â†’ è¯»å–è¡¨å•å½“å‰å€¼

ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹è¡¨å• â†’ æ¸…é™¤ _aiParsedParams
ç”¨æˆ·åˆ‡æ¢é¢˜å‹ â†’ æ¸…é™¤ _aiParsedParams
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹AIè§£æç»“æœ
æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œæœç´¢ï¼š
```
ğŸŒ å¼€å§‹è¯·æ±‚åç«¯ API
âœ… åç«¯è¿”å›æ•°æ®
âœ¨ ä½¿ç”¨ AI è§£æçš„å‚æ•°
```

### æŸ¥çœ‹Canvasæ¸²æŸ“
æœç´¢ï¼š
```
ğŸ¨ drawScene() è¢«è°ƒç”¨
ğŸ¨ åŒ€å˜é€Ÿè¿åŠ¨æ–¹å‘
ğŸ”„ åœ†å‘¨è¿åŠ¨å‚æ•°
```

### æŸ¥çœ‹å‚æ•°è¯»å–
æœç´¢ï¼š
```
ğŸ“ ä»è¡¨å•è¯»å–å‚æ•°
âœ¨ ä½¿ç”¨ AI è§£æçš„å‚æ•°ï¼ˆä¸è¯»å–è¡¨å•é»˜è®¤å€¼ï¼‰
```

---

## ğŸ“Œ å¸¸è§ä¿®æ”¹åœºæ™¯

### æ·»åŠ æ–°çš„ç‰©ç†è¿åŠ¨ç±»å‹

1. **åœ¨HTMLæ·»åŠ é€‰é¡¹**ï¼ˆ~è¡Œ408ï¼‰ï¼š
```html
<option value="mymotion">æˆ‘çš„è¿åŠ¨</option>
```

2. **åœ¨populateParamsForTypeæ·»åŠ å‚æ•°å­—æ®µ**ï¼ˆ~è¡Œ3020ï¼‰ï¼š
```javascript
else if (type === 'mymotion') {
  dynamicParams.appendChild(createParamField('input-myParam', 'æˆ‘çš„å‚æ•°', '10'));
}
```

3. **åœ¨getParamsæ·»åŠ è¯»å–é€»è¾‘**ï¼ˆ~è¡Œ2900ï¼‰ï¼š
```javascript
if (type === 'mymotion') {
  params.myParam = parseFloat(...);
}
```

4. **åœ¨drawSceneæ·»åŠ åˆ†å‘**ï¼ˆ~è¡Œ1210ï¼‰ï¼š
```javascript
case 'mymotion':
  drawMyMotion();
  break;
```

5. **å®ç°ç»˜åˆ¶å‡½æ•°**ï¼ˆ~è¡Œ2750æ–°å¢ï¼‰ï¼š
```javascript
function drawMyMotion() {
  // ç»˜åˆ¶é€»è¾‘
}
```

---

### ä¿®æ”¹AIåç«¯åœ°å€

ä¿®æ”¹è¡Œ ~3157ï¼š
```javascript
const BACKEND_PATH = 'http://localhost:8787/api/parse-problem';  // æœ¬åœ°æµ‹è¯•
```

---

### è°ƒæ•´é»˜è®¤å‚æ•°å€¼

ä¿®æ”¹ `populateParamsForType()` å‡½æ•°ï¼ˆ~è¡Œ3005ï¼‰ï¼š
```javascript
dynamicParams.appendChild(createParamField('input-acceleration', 'åŠ é€Ÿåº¦ (m/s^2)', '9.8'));
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `AIæ¥å…¥é—®é¢˜ä¿®å¤è¯´æ˜.md` - AIé›†æˆtroubleshooting
- `DEEPSEEK_é…ç½®æŒ‡å—.md` - DeepSeek APIé…ç½®
- `backend/worker/index.js` - Cloudflare Workeråç«¯ä»£ç 
- `test-deepseek-prompt.js` - æœ¬åœ°æµ‹è¯•è„šæœ¬

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **SVGå›¾åƒç¼“å­˜** - `window._carImageCache` é¿å…é‡å¤ç”Ÿæˆ
2. **CanvasåŒç¼“å†²** - ä½¿ç”¨ç¦»å±Canvasæ¸²æŸ“å¤æ‚åœºæ™¯
3. **requestAnimationFrame** - é«˜æ•ˆåŠ¨ç”»å¾ªç¯
4. **debounceè¾“å…¥äº‹ä»¶** - é˜²æ­¢è¿‡åº¦è§¦å‘AIè§£æ

---

## ğŸš€ æ‰©å±•åŠŸèƒ½æ€è·¯

- [ ] æ”¯æŒæ›´å¤šç‰©ç†åœºæ™¯ï¼ˆå¼¹ç°§æŒ¯åŠ¨ã€æ³¢åŠ¨ç­‰ï¼‰
- [ ] AIæ™ºèƒ½æ¨¡å‹é€‰æ‹©å™¨ï¼ˆæ ¹æ®sceneDescriptionè‡ªåŠ¨é€‰æ‹©ç‰©ä½“æ ·å¼ï¼‰
- [ ] å®æ—¶ç‰©ç†ä»¿çœŸï¼ˆVerletç§¯åˆ†ã€ç¢°æ’æ£€æµ‹ï¼‰
- [ ] 3Då¯è§†åŒ–ï¼ˆThree.jsé›†æˆï¼‰
- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆi18nï¼‰
